<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using buzzr to handle buzzdetect data • buzzr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using buzzr to handle buzzdetect data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">buzzr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/buzzr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using buzzr to handle buzzdetect data</h1>
            
      

      <div class="d-none name"><code>buzzr.Rmd</code></div>
    </div>

    
    
<p>This vignette is a comprehensive guide for using buzzr to manipulate
buzzdetect result files. buzzr is a companion package to <a href="https://github.com/OSU-Bee-Lab/buzzdetect" class="external-link">buzzdetect</a>, a tool
for passive acoustic monitoring of pollinators. For details about
running buzzdetect itself, see the <a href="https://buzzdetect.readthedocs.io/en/latest/" class="external-link">buzzdetect
documentation</a>. For a broader walkthrough of bioacoustic analysis
with buzzdetect and buzzr, see <a href="https://lukehearon.com/buzzdetect/walkthrough" class="external-link">the walkthrough
here</a>.</p>
<div class="section level2">
<h2 id="tldr">TL;DR<a class="anchor" aria-label="anchor" href="#tldr"></a>
</h2>
<p>The core buzzr functionality is wrapped into a single function,
<code><a href="../reference/bin_directory.html">buzzr::bin_directory</a></code>. This function reads all buzzdetect
results in a folder (recursively), translates the file times (audio
timestamps in seconds) to date-times (e.g. “January 1, 2000 12:42 PM”),
applies thresholds to turn neuron activations into detections, and bins
detections according to their start time.</p>
<p>Here’s an example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">buzzr</span><span class="fu">::</span><span class="fu"><a href="../reference/bin_directory.html">bin_directory</a></span><span class="op">(</span></span>
<span>  dir_results<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/five_flowers'</span>, package<span class="op">=</span><span class="st">'buzzr'</span><span class="op">)</span>,</span>
<span>  thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ins_buzz<span class="op">=</span><span class="op">-</span><span class="fl">1.2</span><span class="op">)</span>,</span>
<span>  posix_formats <span class="op">=</span> <span class="st">'%y%m%d_%H%M'</span>,</span>
<span>  dir_nesting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'flower'</span>,<span class="st">'recorder'</span><span class="op">)</span>,</span>
<span>  tz <span class="op">=</span> <span class="st">'America/New_York'</span>,</span>
<span>  binwidth <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Grouping time bins using columns: flower, recorder</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     flower recorder        bin_datetime detections_ins_buzz frames</span></span>
<span><span class="co">##     &lt;char&gt;   &lt;char&gt;              &lt;POSc&gt;               &lt;int&gt;  &lt;num&gt;</span></span>
<span><span class="co">## 1: chicory    1_104 2025-07-04 00:00:00                   1   1250</span></span>
<span><span class="co">## 2: chicory    1_104 2025-07-04 00:20:00                   4   1250</span></span>
<span><span class="co">## 3: chicory    1_104 2025-07-04 00:40:00                   3   1250</span></span>
<span><span class="co">## 4: chicory    1_104 2025-07-04 01:00:00                   2   1250</span></span>
<span><span class="co">## 5: chicory    1_104 2025-07-04 01:20:00                   0   1250</span></span>
<span><span class="co">## 6: chicory    1_104 2025-07-04 01:40:00                   0   1250</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>For this walkthrough, we will use the buzzdetect results included
with this package. The results correspond to some of the recordings
described in <a href="https://doi.org/10.1093/jisesa/ieaf104" class="external-link">the
buzzdetect manuscript</a>. Recorders were placed by five flowers in
bloom (chicory, mustard, pumpkin, soybean, and watermelon) and allowed
to record for 24 hours. The resulting audio was analyzed buzzdetect;
we’ll refer to the resulting dataset as the “Five Flowers” dataset. To
keep the buzzr version of the dataset light, we have retained only a
single recorder from each plant and trimmed down the files. Find the
full dataset in the <a href="https://zenodo.org/records/17857856" class="external-link">Zenodo
repository</a>.</p>
<div class="section level3">
<h3 id="locating-the-dataset">Locating the dataset<a class="anchor" aria-label="anchor" href="#locating-the-dataset"></a>
</h3>
<p>The path to the Five Flowers dataset on your machine can be retrieved
with the <code>system.file</code> function. Let’s have a look.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://OSU-Bee-Lab.github.io/buzzr" class="external-link">buzzr</a></span><span class="op">)</span></span>
<span><span class="va">dir_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/five_flowers'</span>, package<span class="op">=</span><span class="st">'buzzr'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">paths_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span></span>
<span>  <span class="va">dir_data</span>,</span>
<span>  recursive<span class="op">=</span><span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">paths_results</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "chicory/1_104/250704_0000_buzzdetect.csv"  </span></span>
<span><span class="co">## [2] "mustard/54/240904_0000_buzzdetect.csv"     </span></span>
<span><span class="co">## [3] "pumpkin/1_37/240808_0000_buzzdetect.csv"   </span></span>
<span><span class="co">## [4] "soybean/9/230809_0000_buzzdetect.csv"      </span></span>
<span><span class="co">## [5] "watermelon/1_73/240727_0000_buzzdetect.csv"</span></span></code></pre>
<p>Here we see that the results are stored in folders according to the
pattern <code>flower/recorder_id/HHMMDD_MMSS_buzzdetect.csv</code>.</p>
</div>
<div class="section level3">
<h3 id="results-file-structure">Results file structure<a class="anchor" aria-label="anchor" href="#results-file-structure"></a>
</h3>
<p>Let’s look at a single results file using base R:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_data</span>, <span class="va">paths_results</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">path_results</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_base</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   start activation_ins_buzz activation_ambient_rain activation_ins_trill</span></span>
<span><span class="co">## 1  0.00                -1.7                    -2.0                 -1.9</span></span>
<span><span class="co">## 2  0.96                -2.0                    -2.0                 -1.9</span></span>
<span><span class="co">## 3  1.92                -2.1                    -2.8                 -2.8</span></span>
<span><span class="co">## 4  2.88                -2.0                    -2.6                 -2.4</span></span>
<span><span class="co">## 5  3.84                -2.0                    -2.3                 -2.4</span></span>
<span><span class="co">## 6  4.80                -1.8                    -1.5                 -1.6</span></span>
<span><span class="co">##   activation_mech_plane</span></span>
<span><span class="co">## 1                  -2.2</span></span>
<span><span class="co">## 2                  -2.4</span></span>
<span><span class="co">## 3                  -3.4</span></span>
<span><span class="co">## 4                  -3.2</span></span>
<span><span class="co">## 5                  -2.5</span></span>
<span><span class="co">## 6                  -2.3</span></span></code></pre>
<p>We have a start column and the activations for a few different
neurons. Each row is a single frame, which is a 0.96s span of audio for
these results.</p>
</div>
</div>
<div class="section level2">
<h2 id="reading">Reading results<a class="anchor" aria-label="anchor" href="#reading"></a>
</h2>
<p>Result files can be well over a hundred thousand rows long, so
<code>read.csv</code> is quite slow. Let’s try buzzr instead, which
leverages <code><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">data.table::fread</a></code>. The function we want is
<code><a href="../reference/read_results.html">buzzr::read_results</a></code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_buzzr</span> <span class="op">&lt;-</span> <span class="fu">buzzr</span><span class="fu">::</span><span class="fu"><a href="../reference/read_results.html">read_results</a></span><span class="op">(</span><span class="va">path_results</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_buzzr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    start_filetime activation_ins_buzz activation_ambient_rain</span></span>
<span><span class="co">##             &lt;num&gt;               &lt;num&gt;                   &lt;num&gt;</span></span>
<span><span class="co">## 1:           0.00                -1.7                    -2.0</span></span>
<span><span class="co">## 2:           0.96                -2.0                    -2.0</span></span>
<span><span class="co">## 3:           1.92                -2.1                    -2.8</span></span>
<span><span class="co">## 4:           2.88                -2.0                    -2.6</span></span>
<span><span class="co">## 5:           3.84                -2.0                    -2.3</span></span>
<span><span class="co">## 6:           4.80                -1.8                    -1.5</span></span>
<span><span class="co">##    activation_ins_trill activation_mech_plane</span></span>
<span><span class="co">##                   &lt;num&gt;                 &lt;num&gt;</span></span>
<span><span class="co">## 1:                 -1.9                  -2.2</span></span>
<span><span class="co">## 2:                 -1.9                  -2.4</span></span>
<span><span class="co">## 3:                 -2.8                  -3.4</span></span>
<span><span class="co">## 4:                 -2.4                  -3.2</span></span>
<span><span class="co">## 5:                 -2.4                  -2.5</span></span>
<span><span class="co">## 6:                 -1.6                  -2.3</span></span></code></pre>
<p>You can see that buzzr renamed the default “start” column to the
buzzr convention of “start_filetime”. This allows buzzr to distinguish
between timestamps for file-time (as seconds from the start of file) and
timestamps for real-world time (as date-time).</p>
<div class="section level3">
<h3 id="using-buzzr-to-interpret-date-time">Using buzzr to interpret date-time<a class="anchor" aria-label="anchor" href="#using-buzzr-to-interpret-date-time"></a>
</h3>
<p>We can use buzzr to interpret the date-time of a recording from the
name of the results file. For this, we need several more arguments.</p>
<ul>
<li><p><strong>posix_formats:</strong> A string (or vector of strings)
containing the POSIX format code. Our files are saved with a 2-digit
year, 2-digit month, 2-digit day, underscore, 24-hour hour, and minute.
That is, “YYMMDD_HHMM”. The way to write this as a POSIX format string
is: <code>%y%m%d_%H%M</code>.</p></li>
<li><p><strong>first_match:</strong> If multiple POSIX format strings
are supplied and the file matches multiple formats, should the first
match be used (TRUE) or should NA be returned (FALSE, default)? This is
won’t be needed if you’re working with a single file, but if you have
multiple format (perhaps from using different recorders in the same
experiment), this allows <code>read_directory</code> or
<code>bin_directory</code> to read all of the results in one
go.</p></li>
<li><p><strong>drop_filetime:</strong> Should the output results retain
the start_filetime column alongside start_datetime (FALSE) or should it
be dropped (TRUE)? Note: this argument is only respected if POSIX
formats are given. File-time will not be dropped if there is no other
time column.</p></li>
<li><p><strong>tz:</strong> The time zone to use for the POSIX
translation. Required if translating results to date-time. Should match
the time zone of the recordings. Time zones are a real nightmare. If
you’re finding everything is plotting incorrectly, it’s probably a time
zone issue.</p></li>
</ul>
<p>Date-time data are unfortunately cumbersome, but you should only have
to figure out these settings once per project.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_datetime</span> <span class="op">&lt;-</span> <span class="fu">buzzr</span><span class="fu">::</span><span class="fu"><a href="../reference/read_results.html">read_results</a></span><span class="op">(</span></span>
<span>  <span class="va">path_results</span>,</span>
<span>  posix_formats <span class="op">=</span> <span class="st">'%y%m%d_%H%M'</span>,  <span class="co"># YYMMDD_HHMM</span></span>
<span>  first_match <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># doesn't matter in this case, since we have only one format</span></span>
<span>  drop_filetime <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># keep the start_filetime column (by default, it's dropped)</span></span>
<span>  tz<span class="op">=</span><span class="st">'America/New_York'</span>  <span class="co"># the time zone these data were collected in</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_datetime</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         start_datetime start_filetime activation_ins_buzz</span></span>
<span><span class="co">##                 &lt;POSc&gt;          &lt;num&gt;               &lt;num&gt;</span></span>
<span><span class="co">## 1: 2025-07-04 00:00:00           0.00                -1.7</span></span>
<span><span class="co">## 2: 2025-07-04 00:00:00           0.96                -2.0</span></span>
<span><span class="co">## 3: 2025-07-04 00:00:01           1.92                -2.1</span></span>
<span><span class="co">## 4: 2025-07-04 00:00:02           2.88                -2.0</span></span>
<span><span class="co">## 5: 2025-07-04 00:00:03           3.84                -2.0</span></span>
<span><span class="co">## 6: 2025-07-04 00:00:04           4.80                -1.8</span></span>
<span><span class="co">##    activation_ambient_rain activation_ins_trill activation_mech_plane</span></span>
<span><span class="co">##                      &lt;num&gt;                &lt;num&gt;                 &lt;num&gt;</span></span>
<span><span class="co">## 1:                    -2.0                 -1.9                  -2.2</span></span>
<span><span class="co">## 2:                    -2.0                 -1.9                  -2.4</span></span>
<span><span class="co">## 3:                    -2.8                 -2.8                  -3.4</span></span>
<span><span class="co">## 4:                    -2.6                 -2.4                  -3.2</span></span>
<span><span class="co">## 5:                    -2.3                 -2.4                  -2.5</span></span>
<span><span class="co">## 6:                    -1.5                 -1.6                  -2.3</span></span></code></pre>
<p>Now we can see we’ve successfully translated the file-time to a
date-time. “start_filetime” is present as before (since chose not to
drop it), but we also have “start_datetime” holding the date-time.
Usually you only care about the date-time, but file-time can be useful.
For example, we could find frames with detected buzzes and use <a href="https://www.ffmpeg.org/" class="external-link">FFmpeg</a> to extract the audio from the
corresponding file times.</p>
</div>
<div class="section level3">
<h3 id="using-buzzr-to-interpret-file-structure">Using buzzr to interpret file structure<a class="anchor" aria-label="anchor" href="#using-buzzr-to-interpret-file-structure"></a>
</h3>
<p>You’ll probably find it convenient to organize your recordings
according to some schema. For example, in this dataset we placed
recordings in folders corresponding to the recorder ID and placed those
folders into ones corresponding to plant type. buzzr lets us extract
information from the file path. We can do this with two arguments:</p>
<ul>
<li>
<strong>dir_nesting</strong>: A character vector used to name the
directory levels above the results file. That is, what does each level
above the results represent? Each element becomes a column in the
output, storing the components of the path for each data file.</li>
<li>
<strong>return_filename</strong>: should the filename be placed into
its own column? You probably won’t care about this unless you want to
pin down a specific problematic recording. For example, if you see a
large spike of positives at 3:00AM, you may want to investigate.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_nesting</span> <span class="op">&lt;-</span> <span class="fu">buzzr</span><span class="fu">::</span><span class="fu"><a href="../reference/read_results.html">read_results</a></span><span class="op">(</span></span>
<span>  <span class="va">path_results</span>,</span>
<span>  dir_nesting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'flower'</span>, <span class="st">'recorder'</span><span class="op">)</span>,</span>
<span>  return_filename <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_nesting</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     flower recorder                   filename start_filetime</span></span>
<span><span class="co">##     &lt;char&gt;   &lt;char&gt;                     &lt;char&gt;          &lt;num&gt;</span></span>
<span><span class="co">## 1: chicory    1_104 250704_0000_buzzdetect.csv           0.00</span></span>
<span><span class="co">## 2: chicory    1_104 250704_0000_buzzdetect.csv           0.96</span></span>
<span><span class="co">## 3: chicory    1_104 250704_0000_buzzdetect.csv           1.92</span></span>
<span><span class="co">## 4: chicory    1_104 250704_0000_buzzdetect.csv           2.88</span></span>
<span><span class="co">## 5: chicory    1_104 250704_0000_buzzdetect.csv           3.84</span></span>
<span><span class="co">## 6: chicory    1_104 250704_0000_buzzdetect.csv           4.80</span></span>
<span><span class="co">##    activation_ins_buzz activation_ambient_rain activation_ins_trill</span></span>
<span><span class="co">##                  &lt;num&gt;                   &lt;num&gt;                &lt;num&gt;</span></span>
<span><span class="co">## 1:                -1.7                    -2.0                 -1.9</span></span>
<span><span class="co">## 2:                -2.0                    -2.0                 -1.9</span></span>
<span><span class="co">## 3:                -2.1                    -2.8                 -2.8</span></span>
<span><span class="co">## 4:                -2.0                    -2.6                 -2.4</span></span>
<span><span class="co">## 5:                -2.0                    -2.3                 -2.4</span></span>
<span><span class="co">## 6:                -1.8                    -1.5                 -1.6</span></span>
<span><span class="co">##    activation_mech_plane</span></span>
<span><span class="co">##                    &lt;num&gt;</span></span>
<span><span class="co">## 1:                  -2.2</span></span>
<span><span class="co">## 2:                  -2.4</span></span>
<span><span class="co">## 3:                  -3.4</span></span>
<span><span class="co">## 4:                  -3.2</span></span>
<span><span class="co">## 5:                  -2.5</span></span>
<span><span class="co">## 6:                  -2.3</span></span></code></pre>
<p>This isn’t terribly useful if we’re d ealing with a single file, but
it’s very convenient <a href="#full-read">when we read an entire
directory</a>. However, your file structure <strong>must</strong> be
rectangular! That is, every file has to have the same level of nesting.
Having both <code>foo/bar/results.csv</code> and
<code>foo/bar/lorem/results.csv</code> won’t work.</p>
</div>
</div>
<div class="section level2">
<h2 id="detections">Calling detections<a class="anchor" aria-label="anchor" href="#detections"></a>
</h2>
<p>Raw neuron activations are not useful by themselves; a threshold must
be applied to convert the activations into discrete detections. The
threshold at which to call detections depends on the model you’re using
and how you want to balance the detection sensitivity against the false
positive rate. We recommend using a threshold with 95% precision (95% of
called buzzes are true) as a starting point, but you may want to
fine-tune if detections are low or if there are sources of false
positives in your audio.</p>
<p>For model_general_v3, a threshold of -1.2 is a good starting point
for calling buzzes. This threshold should roughly correspond to 95%
precision. Activations above this value will count as detected instances
of buzzing. For this vignette, we’ll also try detecting planes with a
threshold of -2. This threshold is arbitrary and untested, but it will
let us see how buzzr handles multiple detection columns.</p>
<p>We can call detections by applying the function
<code><a href="../reference/call_detections.html">buzzr::call_detections</a></code> to a results data frame that has
neuron activations. <code>call_detections</code> takes one argument in
addition to the results data frame:</p>
<ul>
<li>
<strong>thresholds</strong>: a named numeric vector with names
corresponding to the neurons to be binned and the values corresponding
to the desired threshold.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_called</span> <span class="op">&lt;-</span> <span class="fu">buzzr</span><span class="fu">::</span><span class="fu"><a href="../reference/call_detections.html">call_detections</a></span><span class="op">(</span></span>
<span>  <span class="va">df_datetime</span>,</span>
<span>  thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    ins_buzz <span class="op">=</span> <span class="op">-</span><span class="fl">1.2</span>,</span>
<span>    mech_plane <span class="op">=</span> <span class="op">-</span><span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_called</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         start_datetime start_filetime detections_ins_buzz detections_mech_plane</span></span>
<span><span class="co">##                 &lt;POSc&gt;          &lt;num&gt;              &lt;lgcl&gt;                &lt;lgcl&gt;</span></span>
<span><span class="co">## 1: 2025-07-04 00:00:00           0.00               FALSE                 FALSE</span></span>
<span><span class="co">## 2: 2025-07-04 00:00:00           0.96               FALSE                 FALSE</span></span>
<span><span class="co">## 3: 2025-07-04 00:00:01           1.92               FALSE                 FALSE</span></span>
<span><span class="co">## 4: 2025-07-04 00:00:02           2.88               FALSE                 FALSE</span></span>
<span><span class="co">## 5: 2025-07-04 00:00:03           3.84               FALSE                 FALSE</span></span>
<span><span class="co">## 6: 2025-07-04 00:00:04           4.80               FALSE                 FALSE</span></span></code></pre>
<p>We can see that we retain our two time columns, but any “activation_”
columns named in our thresholds have been replaced with “detections_”.
Neurons without a threshold have been dropped.</p>
<p>The detections are binary TRUE/FALSE values. You may be interested in
the total number of detections, in which case we could simply sum the
column.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">total_detections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_called</span><span class="op">$</span><span class="va">detections_ins_buzz</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">total_detections</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2604</span></span></code></pre>
<p>Across the whole day, we saw 2,604 detections out of 90,000 frames
for an average detection rate of 0.03.</p>
<p>While total detection rates are valuable in some cases, a more common
interest is the change in detection rate over time. For that, we need to
bin.</p>
</div>
<div class="section level2">
<h2 id="binning">Binning<a class="anchor" aria-label="anchor" href="#binning"></a>
</h2>
<p>To bin detections by time, we can apply the function
<code><a href="../reference/bin.html">buzzr::bin</a></code> to a results data frame that has called
detections. <code>bin</code> only needs two arguments in addition to the
data frame:</p>
<ul>
<li>
<strong>binwidth</strong>: the size of the bin in minutes</li>
<li>
<strong>calculate_rate</strong>: do you want buzzr to automatically
calculate detection rates (detections/frames) for the detection columns?
While it might seem like this would always be desired, sometimes you
want to modify the binned results multiple times. E.g., first bin with a
width of 1 to compress your data, then bin with a width of 15 for
graphing and a width of 60 for statistical analysis. In this case, you
might as well save the rate calculation for the end.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_bin</span> <span class="op">&lt;-</span> <span class="fu">buzzr</span><span class="fu">::</span><span class="fu"><a href="../reference/bin.html">bin</a></span><span class="op">(</span></span>
<span>  <span class="va">df_called</span>,</span>
<span>  binwidth<span class="op">=</span><span class="fl">15</span>,  <span class="co"># 15-minute bins</span></span>
<span>  calculate_rate <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># calculate our detection rates for us</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_bin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    bin_filetime        bin_datetime detections_ins_buzz detections_mech_plane</span></span>
<span><span class="co">##           &lt;num&gt;              &lt;POSc&gt;               &lt;int&gt;                 &lt;int&gt;</span></span>
<span><span class="co">## 1:            0 2025-07-04 00:00:00                   1                    37</span></span>
<span><span class="co">## 2:          900 2025-07-04 00:15:00                   3                    22</span></span>
<span><span class="co">## 3:         1800 2025-07-04 00:30:00                   2                   106</span></span>
<span><span class="co">## 4:         2700 2025-07-04 00:45:00                   2                    60</span></span>
<span><span class="co">## 5:         3600 2025-07-04 01:00:00                   2                    62</span></span>
<span><span class="co">## 6:         4500 2025-07-04 01:15:00                   0                    12</span></span>
<span><span class="co">##    frames detectionrate_ins_buzz detectionrate_mech_plane</span></span>
<span><span class="co">##     &lt;num&gt;                  &lt;num&gt;                    &lt;num&gt;</span></span>
<span><span class="co">## 1:    938            0.001066098               0.03944563</span></span>
<span><span class="co">## 2:    937            0.003201708               0.02347919</span></span>
<span><span class="co">## 3:    938            0.002132196               0.11300640</span></span>
<span><span class="co">## 4:    937            0.002134472               0.06403415</span></span>
<span><span class="co">## 5:    938            0.002132196               0.06609808</span></span>
<span><span class="co">## 6:    937            0.000000000               0.01280683</span></span></code></pre>
<p>You can see that buzzr handled the file-time and the date-time each
with no problem and now our detections have been turned from booleans to
integers.</p>
<p>Let’s see what these data look like!</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">df_bin</span><span class="op">$</span><span class="va">bin_datetime</span>,</span>
<span>  <span class="va">df_bin</span><span class="op">$</span><span class="va">detections_ins_buzz</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="buzzr_files/figure-html/onefile_plot-1.png" class="r-plt" alt="" width="700"></p>
<p>Cool! We see an obvious trend of buzz detections launching up in the
early morning, then dropping off before midday. There are a few false
positives at night, but they’re dwarfed by the signal from the
daytime.</p>
<div class="section level3">
<h3 id="how-buzzr-identifies-groups">How buzzr identifies groups<a class="anchor" aria-label="anchor" href="#how-buzzr-identifies-groups"></a>
</h3>
<p>When binning, buzzr drops columns for frame times, neuron
activations, and detection rates. Then, for each bin, frame counts and
total detections are summed. If requested, detection rates are also
calculated. <strong>Every</strong> remaining column is used as a group
for binning. This could cause unexpected results if you’ve created
custom columns.</p>
<p>For example:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_called</span><span class="op">$</span><span class="va">newcol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'B'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_called</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_bin_customgroups</span> <span class="op">&lt;-</span> <span class="fu">buzzr</span><span class="fu">::</span><span class="fu"><a href="../reference/bin.html">bin</a></span><span class="op">(</span></span>
<span>  <span class="va">df_called</span>,</span>
<span>  binwidth<span class="op">=</span><span class="fl">15</span>,  <span class="co"># 15-minute bins</span></span>
<span>  calculate_rate <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># calculate our detection rates for us</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Grouping time bins using columns: newcol</span></span></code></pre>
<p>buzzr prints a message showing all grouping columns just in case the
groupings were unintended. Here we can see the bins contain half as many
frames as we would have expected if we weren’t aware of the grouping
logic.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_bin_customgroups</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    newcol bin_filetime        bin_datetime detections_ins_buzz</span></span>
<span><span class="co">##    &lt;char&gt;        &lt;num&gt;              &lt;POSc&gt;               &lt;int&gt;</span></span>
<span><span class="co">## 1:      A            0 2025-07-04 00:00:00                   1</span></span>
<span><span class="co">## 2:      B            0 2025-07-04 00:00:00                   0</span></span>
<span><span class="co">## 3:      A          900 2025-07-04 00:15:00                   1</span></span>
<span><span class="co">## 4:      B          900 2025-07-04 00:15:00                   2</span></span>
<span><span class="co">## 5:      B         1800 2025-07-04 00:30:00                   2</span></span>
<span><span class="co">## 6:      A         1800 2025-07-04 00:30:00                   0</span></span>
<span><span class="co">##    detections_mech_plane frames detectionrate_ins_buzz detectionrate_mech_plane</span></span>
<span><span class="co">##                    &lt;int&gt;  &lt;num&gt;                  &lt;num&gt;                    &lt;num&gt;</span></span>
<span><span class="co">## 1:                    16    469            0.002132196               0.03411514</span></span>
<span><span class="co">## 2:                    21    469            0.000000000               0.04477612</span></span>
<span><span class="co">## 3:                    11    469            0.002132196               0.02345416</span></span>
<span><span class="co">## 4:                    11    468            0.004273504               0.02350427</span></span>
<span><span class="co">## 5:                    56    469            0.004264392               0.11940299</span></span>
<span><span class="co">## 6:                    50    469            0.000000000               0.10660981</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="full-read">Reading entire directories<a class="anchor" aria-label="anchor" href="#full-read"></a>
</h2>
<div class="section level3">
<h3 id="binning-a-directory">Binning a directory<a class="anchor" aria-label="anchor" href="#binning-a-directory"></a>
</h3>
<p>All of the above steps can be completed for every file in a directory
(and all subdirectories) with a single command:
<code><a href="../reference/bin_directory.html">buzzr::bin_directory</a></code>.</p>
<p>For this, we just combine all of the arguments we’ve seen before.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_fullbin</span> <span class="op">&lt;-</span> <span class="fu">buzzr</span><span class="fu">::</span><span class="fu"><a href="../reference/bin_directory.html">bin_directory</a></span><span class="op">(</span></span>
<span>  dir_results<span class="op">=</span><span class="va">dir_data</span>,</span>
<span>  thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ins_buzz<span class="op">=</span><span class="op">-</span><span class="fl">1.2</span><span class="op">)</span>,</span>
<span>  posix_formats <span class="op">=</span> <span class="st">'%y%m%d_%H%M'</span>,</span>
<span>  first_match <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  drop_filetime <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dir_nesting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'flower'</span>,<span class="st">'recorder'</span><span class="op">)</span>,</span>
<span>  return_filename <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tz <span class="op">=</span> <span class="st">'America/New_York'</span>,</span>
<span>  binwidth <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  calculate_rate <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Grouping time bins using columns: flower, recorder, filename</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_fullbin</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     flower recorder                   filename        bin_datetime</span></span>
<span><span class="co">##     &lt;char&gt;   &lt;char&gt;                     &lt;char&gt;              &lt;POSc&gt;</span></span>
<span><span class="co">## 1: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 00:00:00</span></span>
<span><span class="co">## 2: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 00:20:00</span></span>
<span><span class="co">## 3: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 00:40:00</span></span>
<span><span class="co">## 4: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 01:00:00</span></span>
<span><span class="co">## 5: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 01:20:00</span></span>
<span><span class="co">## 6: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 01:40:00</span></span>
<span><span class="co">##    detections_ins_buzz frames detectionrate_ins_buzz</span></span>
<span><span class="co">##                  &lt;int&gt;  &lt;num&gt;                  &lt;num&gt;</span></span>
<span><span class="co">## 1:                   1   1250                 0.0008</span></span>
<span><span class="co">## 2:                   4   1250                 0.0032</span></span>
<span><span class="co">## 3:                   3   1250                 0.0024</span></span>
<span><span class="co">## 4:                   2   1250                 0.0016</span></span>
<span><span class="co">## 5:                   0   1250                 0.0000</span></span>
<span><span class="co">## 6:                   0   1250                 0.0000</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df_fullbin</span><span class="op">$</span><span class="va">flower</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "chicory"    "mustard"    "pumpkin"    "soybean"    "watermelon"</span></span></code></pre>
<p>Rebinning only requires a single command!</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/bin.html">bin</a></span><span class="op">(</span><span class="va">df_fullbin</span>, <span class="fl">120</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Grouping time bins using columns: flower, recorder, filename</span></span></code></pre>
<pre><code><span><span class="co">##     flower recorder                   filename        bin_datetime</span></span>
<span><span class="co">##     &lt;char&gt;   &lt;char&gt;                     &lt;char&gt;              &lt;POSc&gt;</span></span>
<span><span class="co">## 1: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 00:00:00</span></span>
<span><span class="co">## 2: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 02:00:00</span></span>
<span><span class="co">## 3: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 04:00:00</span></span>
<span><span class="co">## 4: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 06:00:00</span></span>
<span><span class="co">## 5: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 08:00:00</span></span>
<span><span class="co">## 6: chicory    1_104 250704_0000_buzzdetect.csv 2025-07-04 10:00:00</span></span>
<span><span class="co">##    detections_ins_buzz frames</span></span>
<span><span class="co">##                  &lt;int&gt;  &lt;num&gt;</span></span>
<span><span class="co">## 1:                  10   7500</span></span>
<span><span class="co">## 2:                   7   7500</span></span>
<span><span class="co">## 3:                   1   7500</span></span>
<span><span class="co">## 4:                 878   7500</span></span>
<span><span class="co">## 5:                1460   7500</span></span>
<span><span class="co">## 6:                 111   7500</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="reading-a-directory">Reading a directory<a class="anchor" aria-label="anchor" href="#reading-a-directory"></a>
</h3>
<p>You may also want to read a directory <em>without</em> binning the
results. For example you may want to try out multiple different
thresholds efficiently, or maybe you want to extract all positive
frames, or examine the behavior of activation values.</p>
<p>The function for this is <code><a href="../reference/read_directory.html">buzzr::read_directory</a></code>, and it
behaves how you expect given the information above.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_fullread</span> <span class="op">&lt;-</span> <span class="fu">buzzr</span><span class="fu">::</span><span class="fu"><a href="../reference/read_directory.html">read_directory</a></span><span class="op">(</span></span>
<span>  dir_results<span class="op">=</span><span class="va">dir_data</span>,</span>
<span>  posix_formats <span class="op">=</span> <span class="st">'%y%m%d_%H%M'</span>,</span>
<span>  first_match <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  drop_filetime <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dir_nesting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'flower'</span>,<span class="st">'recorder'</span><span class="op">)</span>,</span>
<span>  return_filename <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tz <span class="op">=</span> <span class="st">'America/New_York'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_fullread</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 450000</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luke hearon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
